<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Go标准库中文文档</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Go 标准库中文文档" href="index.html" />
    <link rel="next" title="errors" href="errors.html" />
    <link rel="prev" title="httptest" href="net-http-httptest.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body role="document">
<div class="header" role="banner">
  <a href='http://cngolib.com'><h1>Go 标准库中文文档</h1></a>
  <p>cngolib.com · Go开发团队/著 · 黄健宏/译</p>
  <!--
  <div class="logo">
    <a href="index.html">
      <img class="logo" src="_static/" alt="Logo"/>
    </a>
  </div>
  -->
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-sql">
<h1>database/sql<a class="headerlink" href="#database-sql" title="永久链接至标题">¶</a></h1>
<p>本文是 Go 标准库中 database/sql 包文档的翻译，
原文地址为：
<a class="reference external" href="https://golang.org/pkg/database/sql/">https://golang.org/pkg/database/sql/</a></p>
<div class="section" id="id1">
<h2>概述<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>sql 包为操作 SQL 以及类 SQL 数据库提供了一个通用的接口。</p>
<p>sql 包必须与数据库驱动一同使用，
<a class="reference external" href="https://golang.org/s/sqldrivers">https://golang.org/s/sqldrivers</a> 列出了可用的数据库驱动列表。</p>
<p>不支持上下文取消操作（context cancelation）的驱动会在查询完成之后才返回。</p>
<p>更多 sql 包使用示例请见 wiki 页面：
<a class="reference external" href="https://golang.org/s/sqlwiki">https://golang.org/s/sqlwiki</a></p>
</div>
<div class="section" id="id2">
<h2>变量<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>当 QueryRow 没有返回一个行时，
Scan 将返回 ErrNoRows 。
在这种情况下，
QueryRow 将返回一个 *Row 占位符值，
从而将这个错误推延至 Scan 。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">ErrNoRows</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;sql: no rows in result set&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>当用户尝试在事务中执行一个已经提交又或者已经回滚的操作时，
就会返回一个 ErrTxDone ：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">ErrTxDone</span> <span class="p">=</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;sql: Transaction has already been committed or rolled back&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="drivers">
<h2>Drivers 函数<a class="headerlink" href="#drivers" title="永久链接至标题">¶</a></h2>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="nx">Drivers</span><span class="p">()</span> <span class="p">[]</span><span class="kt">string</span>
</pre></div>
</div>
<p>以有序列表的形式返回所有已注册驱动的名字。</p>
</div>
<div class="section" id="register">
<h2>Register 函数<a class="headerlink" href="#register" title="永久链接至标题">¶</a></h2>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="nx">Register</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">driver</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">Driver</span><span class="p">)</span>
</pre></div>
</div>
<p>将带有给定名字的驱动设置为可用。
如果用户以相同的名字重复调用 Register ，
又或者 driver 参数的值为 nil ，
那么 Register 函数将引发一个 panic 错误。</p>
</div>
<div class="section" id="columntype">
<h2>ColumnType 类型<a class="headerlink" href="#columntype" title="永久链接至标题">¶</a></h2>
<p>ColumnType 包含了数据列的名字以及类型：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">ColumnType</span> <span class="kd">struct</span> <span class="p">{</span>
            <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="columntype-databasetypename">
<h3>(*ColumnType) DatabaseTypeName 方法<a class="headerlink" href="#columntype-databasetypename" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">DatabaseTypeName</span><span class="p">()</span> <span class="kt">string</span>
</pre></div>
</div>
<p>返回数据列类型的数据库系统名字。</p>
<p>返回空字符表示该驱动类型名字并未被支持。</p>
<p>驱动的数据类型可以通过查看驱动的文档来得到。</p>
<p>长度指示器不会被包含在内（Length specifiers are not included）。</p>
<p>通用的类型包括 &#8220;VARCHAR&#8221;， &#8220;TEXT&#8221;， &#8220;NVARCHAR&#8221;， &#8220;DECIMAL&#8221;， &#8220;BOOL&#8221;， &#8220;INT&#8221;， &#8220;BIGINT&#8221; 。</p>
</div>
<div class="section" id="columntype-decimalsize">
<h3>(*ColumnType) DecimalSize 方法<a class="headerlink" href="#columntype-decimalsize" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">DecimalSize</span><span class="p">()</span> <span class="p">(</span><span class="nx">precision</span><span class="p">,</span> <span class="nx">scale</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">ok</span> <span class="kt">bool</span><span class="p">)</span>
</pre></div>
</div>
<p>返回小数类型的范围和精度。</p>
<p>如果给定的类型不可用又或者不支持，
那么将返回值 ok 参数的值设置为 false 。</p>
</div>
<div class="section" id="columntype-length">
<h3>(*ColumnType) Length 方法<a class="headerlink" href="#columntype-length" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">Length</span><span class="p">()</span> <span class="p">(</span><span class="nx">length</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">ok</span> <span class="kt">bool</span><span class="p">)</span>
</pre></div>
</div>
<p>对于诸如 text 和 binary 字段类型这种可变长度的数据列类型，
返回它们的数据列类型长度。</p>
<p>如果该类型的长度可以是无限大的，
那么值将被设置为 math.MaxInt64 ，
但具体的长度仍然由数据库本身决定。</p>
<p>如果给定的类型并不是可变长度类型，
比如 int ，
又或者驱动并不支持该类型，
那么返回值 ok 参数的值将被设置为 false 。</p>
</div>
<div class="section" id="columntype-name">
<h3>(*ColumnType) Name 方法<a class="headerlink" href="#columntype-name" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">Name</span><span class="p">()</span> <span class="kt">string</span>
</pre></div>
</div>
<p>返回数据列的名字又或者别名。</p>
</div>
<div class="section" id="columntype-nullable">
<h3>(*ColumnType) Nullable 方法<a class="headerlink" href="#columntype-nullable" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">Nullable</span><span class="p">()</span> <span class="p">(</span><span class="nx">nullable</span><span class="p">,</span> <span class="nx">ok</span> <span class="kt">bool</span><span class="p">)</span>
</pre></div>
</div>
<p>检查给定的数据列能否为 null 。</p>
<p>在驱动不支持该属性的情况下，
ok 参数的值为 false 。</p>
</div>
<div class="section" id="columntype-scantype">
<h3>(*ColumnType) ScanType 方法<a class="headerlink" href="#columntype-scantype" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ci</span> <span class="o">*</span><span class="nx">ColumnType</span><span class="p">)</span> <span class="nx">ScanType</span><span class="p">()</span> <span class="nx">reflect</span><span class="p">.</span><span class="nx">Type</span>
</pre></div>
</div>
<p>返回一种 Go 类型，
该类型能够在 Rows.Scan 进行扫描时使用。</p>
<p>如果驱动不支持该属性，
那么返回空接口类型。</p>
</div>
</div>
<div class="section" id="db">
<h2>DB 类型<a class="headerlink" href="#db" title="永久链接至标题">¶</a></h2>
<p>DB 是一个数据库句柄，
它代表的是包含着零个或多个底层连接的池（pool）。
多个 goroutine 可以安全地、并发地使用这个句柄。</p>
<p>sql 包会自动地创建和释放连接，
并且它也会维护一个由闲置（idle）连接组成的释放池（free pool）。
如果数据库拥有预连接状态（pre-connection state）这一概念，
那么这种状态只会在事务内部可见（observed）。</p>
<p>当 DB.Begin 被调用时，
它返回的 Tx 将与单个连接绑定，
而当事务提交或者回滚时，
这个连接将返回至 DB 的闲置连接池。
闲置连接池的大小可以通过 SetMaxIdleConns 来控制。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">DB</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="open">
<h3>Open 函数<a class="headerlink" href="#open" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">driverName</span><span class="p">,</span> <span class="nx">dataSourceName</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">DB</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Open 函数会根据给定的数据库驱动以及驱动专属的数据源来打开一个数据库，
驱动专属的数据源一般至少会包含数据库的名字以及相关的连接信息。</p>
<p>大多数用户都会通过驱动专属的辅助函数来打开数据库，
这种函数会返回一个指向 DB 结构的指针。
Go 的标准库不包含任何数据库驱动，
所有数据库驱动都是第三方的，
<a class="reference external" href="https://golang.org/s/sqldrivers">https://golang.org/s/sqldrivers</a> 列出了可用的第三方驱动。</p>
<p>Open 有可能会只对参数进行检查，
但是却并不创建实际的数据库连接。
通过调用 Ping 可以检查给定的数据源是否有效。</p>
<p>Open 函数返回的 DB 可以安全地由多个 goroutine 进行并发使用，
并且 DB 也会维护它自有的闲置连接池。
因此，
Oepn 函数通常只需要调用一次，
并且用户通常不需要手动地关闭一个 DB 。</p>
</div>
<div class="section" id="db-begin">
<h3>(*DB) Begin 方法<a class="headerlink" href="#db-begin" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Begin</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">Tx</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>开启一个事务，
事务的隔离级别由驱动决定。</p>
</div>
<div class="section" id="db-begintx">
<h3>(*DB) BeginTx 方法<a class="headerlink" href="#db-begintx" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">BeginTx</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">*</span><span class="nx">TxOptions</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Tx</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>开启一个事务。</p>
<p>给定的上下文会一直使用到事务提交又或者回滚为止。
如果上下文被取消了，
那么 sql 包将会对事务进行回滚。
Tx.Commit 在给定的上下文已被取消时会返回一个错误。</p>
<p>TxOptions 参数是可选的，
传入 nil 则表示使用默认值。
如果用户尝试使用一种驱动不支持的非默认隔离级别，
那么方法将返回一个错误。</p>
</div>
<div class="section" id="db-close">
<h3>(*DB) Close 方法<a class="headerlink" href="#db-close" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Close</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>关闭数据库并释放所有已打开的资源。</p>
<p>因为 DB 句柄通常会长时间存在，
并且会有多个 goroutine 进行分享，
所以用户一般不需要手动地关闭数据库。</p>
</div>
<div class="section" id="db-driver">
<h3>(*DB) Driver 方法<a class="headerlink" href="#db-driver" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Driver</span><span class="p">()</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">Driver</span>
</pre></div>
</div>
<p>返回数据库的底层驱动。</p>
</div>
<div class="section" id="db-exec">
<h3>(*DB) Exec 方法<a class="headerlink" href="#db-exec" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Exec</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>执行指定的查询，
但不返回任何数据行。
方法的 arg 部分用于填写查询语句中包含的占位符的实际参数。</p>
</div>
<div class="section" id="db-execcontext">
<h3>(*DB) ExecContext 方法<a class="headerlink" href="#db-execcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="db-ping">
<h3>(*DB) Ping 方法<a class="headerlink" href="#db-ping" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Ping</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>检查数据库连接是否仍然有效，
并在有需要时建立一个连接。</p>
</div>
<div class="section" id="db-pingcontext">
<h3>(*DB) PingContext 方法<a class="headerlink" href="#db-pingcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">PingContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">error</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="db-prepare">
<h3>(*DB) Prepare 方法<a class="headerlink" href="#db-prepare" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Prepare</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Stmt</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>为之后的查询或执行（execution）创建预处理语句，
多个查询或者执行可以并发地使用 Prepare 返回的预处理语句。
当调用者不再需要这个预处理语句时，
它必须调用这个语句的 Close 方法。</p>
</div>
<div class="section" id="db-preparecontext">
<h3>(*DB) PrepareContext 方法<a class="headerlink" href="#db-preparecontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">PrepareContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Stmt</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>为之后的查询或执行（execution）创建预处理语句，
多个查询或者执行可以并发地使用 Prepare 返回的预处理语句。
当调用者不再需要这个预处理语句时，
它必须调用这个语句的 Close 方法。</p>
<p>给定的上下文将在创建预处理语句时使用，
而不是在执行该语句时使用。</p>
</div>
<div class="section" id="db-query">
<h3>(*DB) Query 方法<a class="headerlink" href="#db-query" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Query</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>执行一个查询并返回多个数据行，
这个查询通常是一个 SELECT 。
方法的 arg 部分用于填写查询语句中包含的占位符的实际参数。</p>
<p>一个单结果示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">age</span> <span class="o">:=</span> <span class="mi">27</span>
<span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;SELECT name FROM users WHERE age=?&quot;</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">name</span> <span class="kt">string</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">name</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s is %d\n&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>一个多结果示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">age</span> <span class="o">:=</span> <span class="mi">27</span>
<span class="nx">q</span> <span class="o">:=</span> <span class="s">`</span>
<span class="s">create temp table uid (id bigint); -- Create temp table for queries.</span>
<span class="s">insert into uid</span>
<span class="s">select id from users where age &lt; ?; -- Populate temp table.</span>

<span class="s">-- First result set.</span>
<span class="s">select</span>
<span class="s">    users.id, name</span>
<span class="s">from</span>
<span class="s">    users</span>
<span class="s">    join uid on users.id = uid.id</span>
<span class="s">;</span>

<span class="s">-- Second result set.</span>
<span class="s">select</span>
<span class="s">    ur.user, ur.role</span>
<span class="s">from</span>
<span class="s">    user_roles as ur</span>
<span class="s">    join uid on uid.id = ur.user</span>
<span class="s">;</span>
<span class="s">`</span>
<span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">defer</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

<span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="p">(</span>
        <span class="nx">id</span>   <span class="kt">int64</span>
        <span class="nx">name</span> <span class="kt">string</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">name</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;id %d name is %s\n&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">!</span><span class="nx">rows</span><span class="p">.</span><span class="nx">NextResultSet</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="s">&quot;expected more result sets&quot;</span><span class="p">,</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Err</span><span class="p">())</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">roleMap</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int64</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s">&quot;user&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s">&quot;admin&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s">&quot;gopher&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="p">(</span>
        <span class="nx">id</span>   <span class="kt">int64</span>
        <span class="nx">role</span> <span class="kt">int64</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">role</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;id %d has role %s\n&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">roleMap</span><span class="p">[</span><span class="nx">role</span><span class="p">])</span>
<span class="p">}</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="db-querycontext">
<h3>(*DB) QueryContext 方法<a class="headerlink" href="#db-querycontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="db-queryrow">
<h3>(*DB) QueryRow 方法<a class="headerlink" href="#db-queryrow" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">QueryRow</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>执行一个预期最多只会返回一个数据行的查询。</p>
<p>这个方法总是会返回一个非空的值，
而它引起的错误则会被推延到数据行的 Scan 方法被调用为止。</p>
<p>示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">id</span> <span class="o">:=</span> <span class="mi">123</span>
<span class="kd">var</span> <span class="nx">username</span> <span class="kt">string</span>
<span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">QueryRow</span><span class="p">(</span><span class="s">&quot;SELECT username FROM users WHERE id=?&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">username</span><span class="p">)</span>
<span class="k">switch</span> <span class="p">{</span>
<span class="k">case</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">:</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;No user with that ID.&quot;</span><span class="p">)</span>
<span class="k">case</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">:</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="k">default</span><span class="p">:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Username is %s\n&quot;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="db-queryrowcontext">
<h3>(*DB) QueryRowContext 方法<a class="headerlink" href="#db-queryrowcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="db-setconnmaxlifetime">
<h3>(*DB) SetConnMaxLifetime 方法<a class="headerlink" href="#db-setconnmaxlifetime" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">SetConnMaxLifetime</span><span class="p">(</span><span class="nx">d</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span>
</pre></div>
</div>
<p>设置可以重用连接的时长。</p>
<p>过期的连接可以在重用之前惰性地进行关闭。</p>
<p>如果 d &lt;= 0 ，
那么连接将一直可用。</p>
</div>
<div class="section" id="db-setmaxidleconns">
<h3>(*DB) SetMaxIdleConns 方法<a class="headerlink" href="#db-setmaxidleconns" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">SetMaxIdleConns</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span>
</pre></div>
</div>
<p>设置闲置连接池里面最多可放置的连接数量。</p>
<p>如果 MaxOpenConns 大于 0 但小于新的 MaxIdleConns ，
那么将 MaxIdleConns 的值设置为与 MaxOpenConns 一样。</p>
<p>如果 n &lt;= 0 ，
那么不存放任何闲置的连接。</p>
</div>
<div class="section" id="db-setmaxopenconns">
<h3>(*DB) SetMaxOpenConns 方法<a class="headerlink" href="#db-setmaxopenconns" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">SetMaxOpenConns</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)</span>
</pre></div>
</div>
<p>设置最大可创建的数据库连接数量。</p>
<p>如果 MaxIdleConns 大于 0 并且新的 MaxOpenConns 小于 MaxIdleConns ，
那么 MaxIdleConns 的值将设置为与 MaxOpenConns 一样。</p>
<p>如果 n &lt;= 0 ，
那么表示不限制数据库连接的数量。
默认值为 0 （无限制）。</p>
</div>
<div class="section" id="db-stats">
<h3>(*DB) Stats 方法<a class="headerlink" href="#db-stats" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">db</span> <span class="o">*</span><span class="nx">DB</span><span class="p">)</span> <span class="nx">Stats</span><span class="p">()</span> <span class="nx">DBStats</span>
</pre></div>
</div>
<p>返回数据库的统计数据。</p>
</div>
</div>
<div class="section" id="dbstats">
<h2>DBStats 类型<a class="headerlink" href="#dbstats" title="永久链接至标题">¶</a></h2>
<p>DBStats 包含了数据库的统计数据。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">DBStats</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// OpenConnections is the number of open connections to the database.</span>
    <span class="nx">OpenConnections</span> <span class="kt">int</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="isolationlevel">
<h2>IsolationLevel 类型<a class="headerlink" href="#isolationlevel" title="永久链接至标题">¶</a></h2>
<p>IsolationLevel 是用于 TxOptions 的事务隔离级别：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">IsolationLevel</span> <span class="kt">int</span>
</pre></div>
</div>
<p>不同驱动在 BeginTx 中对隔离级别的支持也是不同的，
如果一个驱动不支持给定的隔离级别，
那么 BeginTx 将返回一个错误。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">const</span> <span class="p">(</span>
    <span class="nx">LevelDefault</span> <span class="nx">IsolationLevel</span> <span class="p">=</span> <span class="kc">iota</span>
    <span class="nx">LevelReadUncommitted</span>
    <span class="nx">LevelReadCommitted</span>
    <span class="nx">LevelWriteCommitted</span>
    <span class="nx">LevelRepeatableRead</span>
    <span class="nx">LevelSnapshot</span>
    <span class="nx">LevelSerializable</span>
    <span class="nx">LevelLinearizable</span>
<span class="p">)</span>
</pre></div>
</div>
<p>关于隔离级别的更多信息请查看：<a class="reference external" href="https://en.wikipedia.org/wiki/Isolation_(database_systems">https://en.wikipedia.org/wiki/Isolation_(database_systems</a>)#Isolation_levels</p>
</div>
<div class="section" id="namedarg">
<h2>NamedArg 类型<a class="headerlink" href="#namedarg" title="永久链接至标题">¶</a></h2>
<p>一个 NamedArg 就是一个具名参数。
NamedArg 的值可以用作 Query 或者 Exec 的参数，
并与 SQL 语句中相应的具名参数进行绑定。</p>
<p>通过 Named 函数可以更方便地创建 NamedArg 值。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">NamedArg</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// 参数占位符的名字。</span>
    <span class="c1">// 如为空，那么根据参数列表中的排列位置进行设置。</span>
    <span class="c1">// Name 必须省略所有符号前缀。</span>
    <span class="nx">Name</span> <span class="kt">string</span>

    <span class="c1">// 参数的值。</span>
    <span class="c1">// 这个参数可能会被设置为与查询参数具有相同的值类型。</span>
    <span class="nx">Value</span> <span class="kd">interface</span><span class="p">{}</span>

    <span class="c1">// 其他已过滤字段以及未导出字段</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="named">
<h3>Named 函数<a class="headerlink" href="#named" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="nx">Named</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="nx">NamedArg</span>
</pre></div>
</div>
<p>Named 提供了一种更为方便的创建 NamedArg 值的方法。</p>
<p>以下是一个使用示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">`</span>
<span class="s">    delete from Invoice</span>
<span class="s">    where</span>
<span class="s">        TimeCreated &lt; @end</span>
<span class="s">        and TimeCreated &gt;= @start;`</span><span class="p">,</span>
    <span class="nx">sql</span><span class="p">.</span><span class="nx">Named</span><span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="nx">startTime</span><span class="p">),</span>
    <span class="nx">sql</span><span class="p">.</span><span class="nx">Named</span><span class="p">(</span><span class="s">&quot;end&quot;</span><span class="p">,</span> <span class="nx">endTime</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nullbool">
<h2>NullBool 类型<a class="headerlink" href="#nullbool" title="永久链接至标题">¶</a></h2>
<p>NullBool 表示一个可能为 null 的布尔值。
NullBool 实现了 Scanner 接口，
因此它可以跟 NullString 一样用作扫描目的地（destination）：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">NullBool</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Bool</span>  <span class="kt">bool</span>
    <span class="nx">Valid</span> <span class="kt">bool</span> <span class="c1">// 当 Bool 字段的值不为 NULL 时， Valid 字段的值为 true</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="nullbool-scan">
<h3>(*NullBool) Scan 方法<a class="headerlink" href="#nullbool-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">NullBool</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>Scan 实现了 Scanner 接口。</p>
</div>
<div class="section" id="nullbool-value">
<h3>(NullBool) Value 方法<a class="headerlink" href="#nullbool-value" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="nx">NullBool</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Value 实现了驱动的 Valuer 接口。</p>
</div>
</div>
<div class="section" id="nullfloat64">
<h2>NullFloat64 类型<a class="headerlink" href="#nullfloat64" title="永久链接至标题">¶</a></h2>
<p>NullFloat64 用于表示一个可能为 null 的 float64 值。</p>
<p>NullFloat64 实现了 Scanner 接口，
因此它可以跟 NullString 一样用作扫描目的地：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">NullFloat64</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Float64</span> <span class="kt">float64</span>
    <span class="nx">Valid</span>   <span class="kt">bool</span> <span class="c1">// 当 Float64 不为 NULL 时，Valid 为 true</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="nullfloat64-scan">
<h3>(*NullFloat64) Scan 方法<a class="headerlink" href="#nullfloat64-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">NullFloat64</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>Scan 实现了 Scanner 接口。</p>
</div>
<div class="section" id="nullfloat64-value">
<h3>(NullFloat64) Value 方法<a class="headerlink" href="#nullfloat64-value" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="nx">NullFloat64</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Value 实现了驱动的 Valuer 接口。</p>
</div>
</div>
<div class="section" id="nullint64">
<h2>NullInt64 类型<a class="headerlink" href="#nullint64" title="永久链接至标题">¶</a></h2>
<p>NullInt64 用于表示一个可能为 null 的 int64 值。
NullInt64 实现了 Scanner 接口，
因此它可以跟 NullString 一样用作扫描目的地：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">NullInt64</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Int64</span> <span class="kt">int64</span>
    <span class="nx">Valid</span> <span class="kt">bool</span> <span class="c1">// 当 Int64 不为 NULL 时，Valid 为 true</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="nullint64-scan">
<h3>(*NullInt64) Scan 方法<a class="headerlink" href="#nullint64-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="o">*</span><span class="nx">NullInt64</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>Scan 实现了 Scanner 接口。</p>
</div>
<div class="section" id="nullint64-value">
<h3>(NullInt64) Value 方法<a class="headerlink" href="#nullint64-value" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">n</span> <span class="nx">NullInt64</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Value 实现了驱动的 Valuer 接口。</p>
</div>
</div>
<div class="section" id="nullstring">
<h2>NullString 类型<a class="headerlink" href="#nullstring" title="永久链接至标题">¶</a></h2>
<p>NullString 表示一个可能为 null 的字符串：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">NullString</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">String</span> <span class="kt">string</span>
    <span class="nx">Valid</span>  <span class="kt">bool</span> <span class="c1">// 当 String 不为 NULL 时，Valid 为 true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>NullString 实现了 Scanner 接口，
因此它可以用作扫描目的地：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">s</span> <span class="nx">NullString</span>
<span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">QueryRow</span><span class="p">(</span><span class="s">&quot;SELECT name FROM foo WHERE id=?&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">s</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">if</span> <span class="nx">s</span><span class="p">.</span><span class="nx">Valid</span> <span class="p">{</span>
       <span class="c1">// use s.String</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="c1">// NULL value</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="nullstring-scan">
<h3>(*NullString) Scan 方法<a class="headerlink" href="#nullstring-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ns</span> <span class="o">*</span><span class="nx">NullString</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>Scan 实现了 Scanner 接口。</p>
</div>
<div class="section" id="nullstring-value">
<h3>(NullString) Value 方法<a class="headerlink" href="#nullstring-value" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">ns</span> <span class="nx">NullString</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">Value</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Value 实现了驱动的 Valuer 接口。</p>
</div>
</div>
<div class="section" id="rawbytes">
<h2>RawBytes 类型<a class="headerlink" href="#rawbytes" title="永久链接至标题">¶</a></h2>
<p>RawBytes 是一个字节串，
它持有一个引用，
该引用指向数据库自身拥有的内存。</p>
<p>在 Scan 将结果储存到一个 RawBytes 之后，
该切片会在下一个 Next 、Scan 或者 Close 调用之前一直有效。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">RawBytes</span> <span class="p">[]</span><span class="kt">byte</span>
</pre></div>
</div>
</div>
<div class="section" id="result">
<h2>Result 类型<a class="headerlink" href="#result" title="永久链接至标题">¶</a></h2>
<p>Result 是对已执行 SQL 命令的总结。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Result</span> <span class="kd">interface</span> <span class="p">{</span>

    <span class="nx">LastInsertId</span><span class="p">()</span> <span class="p">(</span><span class="kt">int64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

    <span class="nx">RowsAffected</span><span class="p">()</span> <span class="p">(</span><span class="kt">int64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>LastInsertId() 会返回一个由数据库生成的整数，
这个整数是对命令的响应。
在插入一个新的数据行时，
这个整数通常来源于数据表中的自增数据列。
并不是所有数据库都支持这个特性，
并且各个数据库在实现这个特性时使用的语句也会有所不同。</p>
<p>RowsAffected() 返回受到更新、插入或者删除操作影响的行数量，
并不是所有数据库或者所有数据库驱动都支持这个特性。</p>
</div>
<div class="section" id="row">
<h2>Row 类型<a class="headerlink" href="#row" title="永久链接至标题">¶</a></h2>
<p>Row 是调用 QueryRow 查询单个数据行所得的结果。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Row</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="row-scan">
<h3>(*Row) Scan 方法<a class="headerlink" href="#row-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Row</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">dest</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>Scan 会将被匹配数据行中的各个列复制到 dest 指向的值里面，
更多细节请参考 Rows.Scan 方法的文档。
如果有多个数据行与查询匹配，
那么 Scan 将使用第一个数据行并丢弃其他所有数据行。
如果没有任何数据行与查询匹配，
那么 Scan 将返回 ErrNoRows 。</p>
</div>
</div>
<div class="section" id="rows">
<h2>Rows 类型<a class="headerlink" href="#rows" title="永久链接至标题">¶</a></h2>
<p>Rows 是查询的结果：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Rows</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<p>它的游标会从结果集的第一个数据行开始，
而用户则可以通过 Next 来遍历结果集中的所有数据行：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">rows</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="s">&quot;SELECT ...&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="k">defer</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<span class="k">for</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">id</span> <span class="kt">int</span>
    <span class="kd">var</span> <span class="nx">name</span> <span class="kt">string</span>
    <span class="nx">err</span> <span class="p">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
<span class="nx">err</span> <span class="p">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">Err</span><span class="p">()</span> <span class="c1">// get any error encountered during iteration</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="section" id="rows-close">
<h3>(*Rows) Close 方法<a class="headerlink" href="#rows-close" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">rs</span> <span class="o">*</span><span class="nx">Rows</span><span class="p">)</span> <span class="nx">Close</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>关闭 Rows ，
停止对数据集的迭代。
如果 Next 返回 false ，
那么 Rows 将自动关闭，
并且用户在自动关闭的情况下也同样能够检查 Err 的结果。</p>
</div>
<div class="section" id="rows-columns">
<h3>(*Rows) Columns 方法<a class="headerlink" href="#rows-columns" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">rs</span> <span class="o">*</span><span class="nx">Rows</span><span class="p">)</span> <span class="nx">Columns</span><span class="p">()</span> <span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>返回各个列的名字。</p>
<p>当数据行已经被关闭时，
Columns 将返回一个错误；
当数据行来自于 QueryRow 时，
Columns 将返回一个推延错误。</p>
</div>
<div class="section" id="rows-err">
<h3>(*Rows) Err 方法<a class="headerlink" href="#rows-err" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">rs</span> <span class="o">*</span><span class="nx">Rows</span><span class="p">)</span> <span class="nx">Err</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>返回迭代过程中出现的任何错误，
这个方法在数据行显式或者隐式关闭之后仍然可用。</p>
</div>
<div class="section" id="rows-next">
<h3>(*Rows) Next 方法<a class="headerlink" href="#rows-next" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">rs</span> <span class="o">*</span><span class="nx">Rows</span><span class="p">)</span> <span class="nx">Next</span><span class="p">()</span> <span class="kt">bool</span>
</pre></div>
</div>
<p>Next 可以为 Scan 方法准备好下一个待读取的数据行：
这个方法在执行成功时返回 true ；
返回 false 表示没有下一个数据行可用，
又或者准备期间发生了错误。</p>
<p>通过 Err 方法可以知道 Next 是因为何种原因而执行失败的。</p>
</div>
<div class="section" id="rows-scan">
<h3>(*Rows) Scan 方法<a class="headerlink" href="#rows-scan" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">rs</span> <span class="o">*</span><span class="nx">Rows</span><span class="p">)</span> <span class="nx">Scan</span><span class="p">(</span><span class="nx">dest</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
</pre></div>
</div>
<p>将当前被迭代数据行的各个列复制到 dest 指向的值里面，
dest 的值数量必须与数据行中的列数量保持一致。</p>
<p>Scan 会把从数据库里面读取到的各个数据列转换为以下标准 Go 类型，
又或者转换为某些由 sql 包提供的特殊类型：</p>
<ul class="simple">
<li>*string</li>
<li>*[]byte</li>
<li>*int, *int8, *int16, *int32, *int64</li>
<li>*uint, *uint8, *uint16, *uint32, *uint64</li>
<li>*bool</li>
<li>*float32, *float64</li>
<li>*interface{}</li>
<li>*RawBytes</li>
<li>实现了 Scanner 接口的任何类型（具体信息请见 Scanner 接口的文档）</li>
</ul>
</div>
</div>
<div class="section" id="scanner">
<h2>Scanner 类型<a class="headerlink" href="#scanner" title="永久链接至标题">¶</a></h2>
<p>Scanner 是 Scan 使用的一个接口：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Scanner</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="c1">// Scan 会通过数据库驱动获取一个值，</span>
    <span class="c1">// 这个值将会是以下类型之一：</span>
    <span class="c1">//</span>
    <span class="c1">//    int64</span>
    <span class="c1">//    float64</span>
    <span class="c1">//    bool</span>
    <span class="c1">//    []byte</span>
    <span class="c1">//    string</span>
    <span class="c1">//    time.Time</span>
    <span class="c1">//    nil - 用于表示 NULL 值</span>
    <span class="c1">//</span>
    <span class="c1">// 当一个值无法以不丢失任何信息的情况下储存时，</span>
    <span class="c1">// 返回一个错误</span>
    <span class="nx">Scan</span><span class="p">(</span><span class="nx">src</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="stmt">
<h2>Stmt 类型<a class="headerlink" href="#stmt" title="永久链接至标题">¶</a></h2>
<p>Stmt 用于代表预处理语句，
多个 goroutine 可以安全地以并发的形式使用这种类型。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Stmt</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="stmt-close">
<h3>(*Stmt) Close 方法<a class="headerlink" href="#stmt-close" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">Close</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>关闭给定的预处理语句。</p>
</div>
<div class="section" id="stmt-exec">
<h3>(*Stmt) Exec 方法<a class="headerlink" href="#stmt-exec" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">Exec</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>使用给定的参数执行预处理语句，
并返回一个 Result 值来总结本次执行产生的影响。</p>
</div>
<div class="section" id="stmt-execcontext">
<h3>(*Stmt) ExecContext 方法<a class="headerlink" href="#stmt-execcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="stmt-query">
<h3>(*Stmt) Query 方法<a class="headerlink" href="#stmt-query" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">Query</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>使用给定的参数执行预处理语句，
并以 *Rows 形式返回查询结果。</p>
</div>
<div class="section" id="stmt-querycontext">
<h3>(*Stmt) QueryContext 方法<a class="headerlink" href="#stmt-querycontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="stmt-queryrow">
<h3>(*Stmt) QueryRow 方法<a class="headerlink" href="#stmt-queryrow" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">QueryRow</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>使用给定的参数执行预处理语句，
并返回一个 *Row 作为结果。
如果语句在执行期间出现了错误，
那么这个错误将会在用户对 *Row 执行 Scan 调用时返回。
因为 Scan 调用总是返回一个非空值，
所以当查询没有获取到任何数据行时，
*Row 的 Scan 调用将返回 ErrNoRows ；
另一方面，
在正常情况下，
*Row 的 Scan 调用将返回查询结果中的第一个数据行，
并丢弃可能存在的所有剩余数据行。</p>
<p>使用示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">name</span> <span class="kt">string</span>
<span class="nx">err</span> <span class="o">:=</span> <span class="nx">nameByUseridStmt</span><span class="p">.</span><span class="nx">QueryRow</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="stmt-queryrowcontext">
<h3>(*Stmt) QueryRowContext 方法<a class="headerlink" href="#stmt-queryrowcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>与 QueryRow 方法作用相同，
只是参数多了个上下文。</p>
<p>使用示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">name</span> <span class="kt">string</span>
<span class="nx">err</span> <span class="o">:=</span> <span class="nx">nameByUseridStmt</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">id</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tx">
<h2>Tx 类型<a class="headerlink" href="#tx" title="永久链接至标题">¶</a></h2>
<p>Tx 是一个进行中的数据库事务。</p>
<p>一个事务必须以调用 Commit 或者 Rollback 为结束，
在调用这两个方法之中的任何一个之后，
事务的所有操作都会以 ErrTxDone 的方式失效（fail）。</p>
<p>通过 Prepare 方法或者 Stmt 方法放入到事务里面的语句，
将在 Commit 调用或者 Rollback 调用之后关闭。</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">Tx</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="c1">// contains filtered or unexported fields</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="tx-commit">
<h3>(*Tx) Commit 方法<a class="headerlink" href="#tx-commit" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Commit</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>提交事务。</p>
</div>
<div class="section" id="tx-exec">
<h3>(*Tx) Exec 方法<a class="headerlink" href="#tx-exec" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Exec</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>执行一个不返回数据行的查询，
比如一个 INSERT 或者一个 UPDATE 。</p>
</div>
<div class="section" id="execcontext">
<h3>(* ExecContext 方法<a class="headerlink" href="#execcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="nx">Result</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="tx-prepare">
<h3>(*Tx) Prepare 方法<a class="headerlink" href="#tx-prepare" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Prepare</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Stmt</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>创建一个可以在事务里面使用的预备语句。</p>
<p>这个方法返回的语句将在事务中执行，
并且它在事务提交或者回滚之后将不再可用。</p>
<p>如果你想要在事务里面使用一个已经存在的预备语句，
那么请使用 Tx.Stmt 方法。</p>
</div>
<div class="section" id="tx-preparecontext">
<h3>(*Tx) PrepareContext 方法<a class="headerlink" href="#tx-preparecontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">PrepareContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Stmt</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>作用同上。</p>
<p>给定的上下文将用于预备阶段，
而不是事务的执行阶段。</p>
<p>这个方法返回的语句将在事务上下文中执行。</p>
</div>
<div class="section" id="tx-query">
<h3>(*Tx) Query 方法<a class="headerlink" href="#tx-query" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Query</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>执行一个会返回数据行的查询，
通常是一个 SELECT 。</p>
</div>
<div class="section" id="tx-querycontext">
<h3>(*Tx) QueryContext 方法<a class="headerlink" href="#tx-querycontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">*</span><span class="nx">Rows</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="tx-queryrow">
<h3>(*Tx) QueryRow 方法<a class="headerlink" href="#tx-queryrow" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">QueryRow</span><span class="p">(</span><span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>执行一个预期最多只会返回一个数据行的查询。</p>
<p>这个方法总是返回一个不为 nil 的值。</p>
<p>执行时的错误将推延到数据行的 Scan 方法执行为止。</p>
</div>
<div class="section" id="tx-queryrowcontext">
<h3>(*Tx) QueryRowContext 方法<a class="headerlink" href="#tx-queryrowcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">query</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Row</span>
</pre></div>
</div>
<p>同上。</p>
</div>
<div class="section" id="tx-rollback">
<h3>(*Tx) Rollback 方法<a class="headerlink" href="#tx-rollback" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Rollback</span><span class="p">()</span> <span class="kt">error</span>
</pre></div>
</div>
<p>终止事务。</p>
</div>
<div class="section" id="tx-stmt">
<h3>(*Tx) Stmt 方法<a class="headerlink" href="#tx-stmt" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">Stmt</span><span class="p">(</span><span class="nx">stmt</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="o">*</span><span class="nx">Stmt</span>
</pre></div>
</div>
<p>为已有的语句返回一个事务专用的预备语句。</p>
<p>示例：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="nx">updateMoney</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Prepare</span><span class="p">(</span><span class="s">&quot;UPDATE balance SET money=money+? WHERE id=?&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="nx">tx</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">Begin</span><span class="p">()</span>
<span class="o">...</span>
<span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">Stmt</span><span class="p">(</span><span class="nx">updateMoney</span><span class="p">).</span><span class="nx">Exec</span><span class="p">(</span><span class="mf">123.45</span><span class="p">,</span> <span class="mi">98293203</span><span class="p">)</span>
</pre></div>
</div>
<p>这个方法返回的语句将在事务中执行。
在事务提交或者回滚之后，
语句也会被关闭。</p>
</div>
<div class="section" id="tx-stmtcontext">
<h3>(*Tx) StmtContext 方法<a class="headerlink" href="#tx-stmtcontext" title="永久链接至标题">¶</a></h3>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">func</span> <span class="p">(</span><span class="nx">tx</span> <span class="o">*</span><span class="nx">Tx</span><span class="p">)</span> <span class="nx">StmtContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">stmt</span> <span class="o">*</span><span class="nx">Stmt</span><span class="p">)</span> <span class="o">*</span><span class="nx">Stmt</span>
</pre></div>
</div>
<p>同上。</p>
</div>
</div>
<div class="section" id="txoptions">
<h2>TxOptions 类型<a class="headerlink" href="#txoptions" title="永久链接至标题">¶</a></h2>
<p>TxOptions 用于持有在 DB.BeginTx 中使用的事务选项：</p>
<div class="highlight-go"><div class="highlight"><pre><span class="kd">type</span> <span class="nx">TxOptions</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// Isolation 用于设置事务的隔离级别</span>
    <span class="c1">// 值为 0 时，使用数据库的默认级别</span>
    <span class="nx">Isolation</span> <span class="nx">IsolationLevel</span>
    <span class="nx">ReadOnly</span>  <span class="kt">bool</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">database/sql</a><ul>
<li><a class="reference internal" href="#id1">概述</a></li>
<li><a class="reference internal" href="#id2">变量</a></li>
<li><a class="reference internal" href="#drivers">Drivers 函数</a></li>
<li><a class="reference internal" href="#register">Register 函数</a></li>
<li><a class="reference internal" href="#columntype">ColumnType 类型</a><ul>
<li><a class="reference internal" href="#columntype-databasetypename">(*ColumnType) DatabaseTypeName 方法</a></li>
<li><a class="reference internal" href="#columntype-decimalsize">(*ColumnType) DecimalSize 方法</a></li>
<li><a class="reference internal" href="#columntype-length">(*ColumnType) Length 方法</a></li>
<li><a class="reference internal" href="#columntype-name">(*ColumnType) Name 方法</a></li>
<li><a class="reference internal" href="#columntype-nullable">(*ColumnType) Nullable 方法</a></li>
<li><a class="reference internal" href="#columntype-scantype">(*ColumnType) ScanType 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#db">DB 类型</a><ul>
<li><a class="reference internal" href="#open">Open 函数</a></li>
<li><a class="reference internal" href="#db-begin">(*DB) Begin 方法</a></li>
<li><a class="reference internal" href="#db-begintx">(*DB) BeginTx 方法</a></li>
<li><a class="reference internal" href="#db-close">(*DB) Close 方法</a></li>
<li><a class="reference internal" href="#db-driver">(*DB) Driver 方法</a></li>
<li><a class="reference internal" href="#db-exec">(*DB) Exec 方法</a></li>
<li><a class="reference internal" href="#db-execcontext">(*DB) ExecContext 方法</a></li>
<li><a class="reference internal" href="#db-ping">(*DB) Ping 方法</a></li>
<li><a class="reference internal" href="#db-pingcontext">(*DB) PingContext 方法</a></li>
<li><a class="reference internal" href="#db-prepare">(*DB) Prepare 方法</a></li>
<li><a class="reference internal" href="#db-preparecontext">(*DB) PrepareContext 方法</a></li>
<li><a class="reference internal" href="#db-query">(*DB) Query 方法</a></li>
<li><a class="reference internal" href="#db-querycontext">(*DB) QueryContext 方法</a></li>
<li><a class="reference internal" href="#db-queryrow">(*DB) QueryRow 方法</a></li>
<li><a class="reference internal" href="#db-queryrowcontext">(*DB) QueryRowContext 方法</a></li>
<li><a class="reference internal" href="#db-setconnmaxlifetime">(*DB) SetConnMaxLifetime 方法</a></li>
<li><a class="reference internal" href="#db-setmaxidleconns">(*DB) SetMaxIdleConns 方法</a></li>
<li><a class="reference internal" href="#db-setmaxopenconns">(*DB) SetMaxOpenConns 方法</a></li>
<li><a class="reference internal" href="#db-stats">(*DB) Stats 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dbstats">DBStats 类型</a></li>
<li><a class="reference internal" href="#isolationlevel">IsolationLevel 类型</a></li>
<li><a class="reference internal" href="#namedarg">NamedArg 类型</a><ul>
<li><a class="reference internal" href="#named">Named 函数</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nullbool">NullBool 类型</a><ul>
<li><a class="reference internal" href="#nullbool-scan">(*NullBool) Scan 方法</a></li>
<li><a class="reference internal" href="#nullbool-value">(NullBool) Value 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nullfloat64">NullFloat64 类型</a><ul>
<li><a class="reference internal" href="#nullfloat64-scan">(*NullFloat64) Scan 方法</a></li>
<li><a class="reference internal" href="#nullfloat64-value">(NullFloat64) Value 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nullint64">NullInt64 类型</a><ul>
<li><a class="reference internal" href="#nullint64-scan">(*NullInt64) Scan 方法</a></li>
<li><a class="reference internal" href="#nullint64-value">(NullInt64) Value 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nullstring">NullString 类型</a><ul>
<li><a class="reference internal" href="#nullstring-scan">(*NullString) Scan 方法</a></li>
<li><a class="reference internal" href="#nullstring-value">(NullString) Value 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rawbytes">RawBytes 类型</a></li>
<li><a class="reference internal" href="#result">Result 类型</a></li>
<li><a class="reference internal" href="#row">Row 类型</a><ul>
<li><a class="reference internal" href="#row-scan">(*Row) Scan 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rows">Rows 类型</a><ul>
<li><a class="reference internal" href="#rows-close">(*Rows) Close 方法</a></li>
<li><a class="reference internal" href="#rows-columns">(*Rows) Columns 方法</a></li>
<li><a class="reference internal" href="#rows-err">(*Rows) Err 方法</a></li>
<li><a class="reference internal" href="#rows-next">(*Rows) Next 方法</a></li>
<li><a class="reference internal" href="#rows-scan">(*Rows) Scan 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scanner">Scanner 类型</a></li>
<li><a class="reference internal" href="#stmt">Stmt 类型</a><ul>
<li><a class="reference internal" href="#stmt-close">(*Stmt) Close 方法</a></li>
<li><a class="reference internal" href="#stmt-exec">(*Stmt) Exec 方法</a></li>
<li><a class="reference internal" href="#stmt-execcontext">(*Stmt) ExecContext 方法</a></li>
<li><a class="reference internal" href="#stmt-query">(*Stmt) Query 方法</a></li>
<li><a class="reference internal" href="#stmt-querycontext">(*Stmt) QueryContext 方法</a></li>
<li><a class="reference internal" href="#stmt-queryrow">(*Stmt) QueryRow 方法</a></li>
<li><a class="reference internal" href="#stmt-queryrowcontext">(*Stmt) QueryRowContext 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tx">Tx 类型</a><ul>
<li><a class="reference internal" href="#tx-commit">(*Tx) Commit 方法</a></li>
<li><a class="reference internal" href="#tx-exec">(*Tx) Exec 方法</a></li>
<li><a class="reference internal" href="#execcontext">(* ExecContext 方法</a></li>
<li><a class="reference internal" href="#tx-prepare">(*Tx) Prepare 方法</a></li>
<li><a class="reference internal" href="#tx-preparecontext">(*Tx) PrepareContext 方法</a></li>
<li><a class="reference internal" href="#tx-query">(*Tx) Query 方法</a></li>
<li><a class="reference internal" href="#tx-querycontext">(*Tx) QueryContext 方法</a></li>
<li><a class="reference internal" href="#tx-queryrow">(*Tx) QueryRow 方法</a></li>
<li><a class="reference internal" href="#tx-queryrowcontext">(*Tx) QueryRowContext 方法</a></li>
<li><a class="reference internal" href="#tx-rollback">(*Tx) Rollback 方法</a></li>
<li><a class="reference internal" href="#tx-stmt">(*Tx) Stmt 方法</a></li>
<li><a class="reference internal" href="#tx-stmtcontext">(*Tx) StmtContext 方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#txoptions">TxOptions 类型</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="net-http-httptest.html"
                        title="上一章">httptest</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="errors.html"
                        title="下一章">errors</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的术语，模块，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &copy; 版权所有 2017, 黄健宏.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3 创建。
    </div>
  </body>
</html>